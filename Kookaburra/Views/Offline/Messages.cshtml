@model Kookaburra.Models.Offline.OfflineMessagesViewModel

@using Newtonsoft.Json;
@using Kookaburra.Domain.Common;

<div id="offline-messages" class="page bg-white offline-messages">

    <div class="page-main">
        <!-- Mailbox Header -->
        <div class="page-header" style="display: none;" data-bind="visible: totalInitialMessages() > 0 || searching() == true">
            <h1 class="page-title">Offline Messages</h1>

            <div class="page-header-actions">
                <form>
                    <div class="input-search input-search-dark">
                        <i class="input-search-icon wb-search" aria-hidden="true"></i>
                        <input type="text" class="form-control" name="" placeholder="Search..." data-bind="textInput: searchTerm, enterkey: search">
                    </div>
                </form>
            </div>
        </div>

        <!-- No Messages -->
        <div class="page-header" style="display: none;" data-bind="visible: totalInitialMessages().length == 0 && searching() == false">
            <div role="alert" class="alert dark alert-info alert-icon alert-dismissible">
                <i class="icon md-alert-circle-o" aria-hidden="true"></i>
                <h4>Messages</h4>
                <p>
                    You don't have any offline messages.
                </p>
            </div>
        </div>

        <!-- No Search Results -->
        <div class="page-header" style="display: none; padding-top: 0; padding-bottom: 0;" data-bind="visible: searching() == true && messages().length == 0">
            <div role="alert" class="alert dark alert-info alert-icon alert-dismissible">
                <i class="icon md-alert-circle-o" aria-hidden="true"></i>
                <h4>No search results for '<span data-bind="text: searchTermLabel"></span>'.</h4>
            </div>
        </div>

        <!-- Search Results -->
        <div class="page-header" style="display: none; padding-top: 0;" data-bind="visible: searching() == true && messages().length > 0">
            <h4>Search results for '<span data-bind="text: searchTermLabel"></span>'.</h4>
        </div>

        <!-- Mailbox Content -->
        <div id="mailContent" class="page-content page-content-table" data-plugin="selectable" style="display: none;" data-bind="visible: totalInitialMessages() > 0">
            <!-- Actions -->
            <div class="page-content-actions">

                <div class="pull-xs-left total-messages" data-bind="visible: totalMessages() > 0 || searching() == false">
                    <span style="display: none;" data-bind="visible: messages().length < totalMessages()">
                        <span data-bind="text: messages().length"></span> of <span data-bind="text: totalMessages"></span> Messages
                    </span>
                    <span style="display: none;" data-bind="visible: messages().length == totalMessages()">
                        <span data-bind="text: totalMessages"></span> Messages
                    </span>
                </div>

                <div class="pull-xs-right filter" style="display: none;" data-bind="visible: searching() == false">
                    <span style="padding-right: 5px;">FILTER:</span>
                    <button type="button" class="btn btn-outline btn-primary" data-bind="click: filterAll, css: {active: filter() == 'All'}">All</button>
                    <button type="button" class="btn btn-outline btn-primary" data-bind="click: filterByDay, css: {active: filter() == 'Day'}">Today</button>
                    <button type="button" class="btn btn-outline btn-primary" data-bind="click: filterByWeek, css: {active: filter() == 'Week'}">Week</button>
                    <button type="button" class="btn btn-outline btn-primary" data-bind="click: filterByMonth, css: {active: filter() == 'Month'}">Month</button>
                </div>

                <div class="pull-xs-right" style="display: none;" data-bind="visible: searching() == true">
                    <button type="button" class="btn btn-outline btn-default pull-right" data-bind="click: backToAll">
                        <i class="icon wb-arrow-left m-r-10" aria-hidden="true"></i>
                        Back to all messages
                    </button>
                </div>
            </div>
            <!-- Mailbox -->

            <div class="pannel">
                <div class="panel-body">
                    <table id="mailboxTable" class="table" data-plugin="animateList" data-animate="fade" data-child="tr">
                        <tbody data-bind="foreach: messages">
                            <tr id="mid_8" data-toggle="slidePanel" class="unread" data-bind="css: {unread: !isRead()}, click: $root.openMessage">
                                <td class="cell-80">
                                    <img src="/images/user-1.png" class="img-circle" alt="user-pic">
                                </td>
                                <td>
                                    <div class="content">
                                        <div class="title" data-bind="text: name"></div>
                                        <div class="abstract" data-bind="text: message"></div>
                                    </div>
                                </td>
                                <td class="cell-30 responsive-hide"></td>
                                <td class="cell-200">
                                    <div class="time" data-bind="text: time"></div>
                                    <div class="identity" data-bind="text: country"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="text-sm-center" data-bind="visible: messages().length < totalMessages()">
                        <button type="button" class="btn btn-default" data-bind="click: showMore">
                            <i class="icon wb-chevron-down margin-right-5" aria-hidden="true"></i>Show More
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div id="message-details-template" style="display: none;">
        <div class="offline-messages" data-bind="with: currentMessage">
            <header class="slidePanel-header">
                <div class="slidePanel-actions" aria-label="actions" role="group">
                    <button type="button" class="btn btn-icon btn-pure btn-inverse slidePanel-close actions-top icon wb-close slidePanel-will-close" aria-hidden="true"></button>
                </div>
                <div class="mail-header">
                    <div class="mail-header-main">
                        <a class="avatar" href="javascript:void(0)">
                            <img src="/images/user-1.png" class="img-circle" alt="user-pic">
                        </a>
                        <div>
                            <h1 class="name" data-bind="text: name"></h1>
                        </div>
                        <div>
                            <a href="#" data-bind="text: email, attr: { href: 'mailto:' + email() }"></a>
                        </div>
                    </div>
                    <div class="mail-header-right">
                        <span class="time" data-bind="text: time"></span>
                    </div>
                    <button type="button" class="btn btn-outline btn-primary" data-bind="attr : {onclick: 'deleteMessage(' + id() + ');'}">Delete</button>
                </div>

            </header>
            <div class="slidePanel-inner">
                <section class="slidePanel-inner-section">
                    <div class="mail-content" data-bind="text: message"></div>
                </section>

                @*<div class="slidePanel-comment">
                    <textarea class="maxlength-textarea form-control mb-sm m-b-20" rows="4" placeholder="Write your reply here..." data-bind="text: reply"></textarea>
                    <button class="btn btn-primary" data-dismiss="modal" type="button" data-bind="click: $root.sendReply">Reply</button>
                </div>*@
            </div>
        </div>
    </div>
</div>


@section css
{
    @Styles.Render("~/bundles/css/offlinemessages")
}

@section js
{
    @Scripts.Render("~/bundles/js/offlinemessage")
}

@section bottom_scripts{
    <script src="~/remark/global/vendor/alertify/alertify.js"></script>
    <script src="~/remark/global/js/Plugin/alertify.js"></script>    
}

<script type="text/javascript"> 

    var initialView = @Html.Raw(JsonConvert.SerializeObject(Model));
    var viewModel = new MessagesViewModel(initialView);

    ko.applyBindings(viewModel, document.getElementById("offline-messages"));

    function deleteMessage(id) {
        viewModel.delete(id);
    }
</script>