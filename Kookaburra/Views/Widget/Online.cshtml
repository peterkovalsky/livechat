@model Kookaburra.ViewModels.Widget.OnlineBoxViewModel
@{
    Layout = "~/Views/Shared/_LayoutWidget.cshtml";
}

@section head{
    @Scripts.Render("~/bundles/js/widget")
    <script src="~/signalr/hubs"></script>
}

<div class="online" data-bind="if: conversationStarted">
    <div class="header">
        <div class="operator-pic"></div>
        <div class="operator-name" data-bind="text: operatorName"></div>
    </div>
    <div id="conversation" class="chat-window">
        <ul id="messages" data-bind="foreach: messages">
            <li>
                <div class="author" data-bind="text: author, css: sentBy"></div>
                <div class="message" data-bind="text: text, css: sentBy"></div>
                @*<span data-bind="text: time"></span>*@
            </li>
        </ul>
    </div>
    <div class="message-box">
        <textarea id="message" class="message" data-bind="textInput: newMessage, hasFocus: isMessageBoxFocus" rows="1"
                  placeholder="Type in your message here and press Enter to send"></textarea>
    </div>
</div>

<div class="gone-offline" data-bind="if: goneOffline">
    Operator has gone offline. Click <a href="/widget/offline/@(Model.AccountKey)">here</a> if you wish leave a message.
</div>


<script type="text/javascript">

    $(document).ready(function () {
        $('#conversation').perfectScrollbar();

        var url = (window.location != window.parent.location) ? document.referrer : document.location;

        var chatWidgetModel = new ChatWidgetViewModel('@Model.AccountKey', url);
        ko.applyBindings(chatWidgetModel);

        // initialise the chat
        chatWidgetModel.init();
    });

</script>